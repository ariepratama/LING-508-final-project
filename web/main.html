<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NER Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    <style type="text/css">
      ul {
       list-style-type: none;
      }
     </style>

</head>
<body>
    <div class="mb-3">
      <input type="text" class="form-control" aria-label="query" id="query"
              onkeyup="showResults(this.value)" placeholder="Search..."/>
    </div>
    <div class="mb-3">
      <ul id="autocomplete-result-list" class="">
      </ul>
    </div>

    <div id="results" class="mb-3">
      
    </div>



<script>
        async function showResults(text) {
            const response = await fetch('http://localhost:5002/ner/related?query=' + text);
            const responsePayload = await response.json();

            res = document.getElementById("autocomplete-result-list")
            res.innerHTML = '';
            let list = '';

            ners = responsePayload["data"]
            for (let i = 0; i < Math.min(ners.length, 5); i++) {
                list += '<li><button type="button" class="btn btn-primary" onclick="onNerClick(this)">' + ners[i] + '</button></li>';
            }
            res.innerHTML = list ;

            doc = document.getElementById("results");
            doc.innerHTML = "";
        }

        async function onNerClick(event) {
          let nerCategory = event.innerHTML;
          console.log(nerCategory)
          let requestPayload = {
            "ner_category": nerCategory
          };
          const response = await fetch("http://localhost:5002/documents/search", {
            method: "POST",
            body: JSON.stringify(requestPayload),
            headers:  {
              'Content-Type': 'application/json',
            }
          });
          const responsePayload = await response.json();
          res = document.getElementById("results")
          res.innerHTML = "";
          
          let docs = '';
          for (let i =0; i < responsePayload["data"].length; i++ ) {
            let text = responsePayload["data"][i].text;
            if (text.length > 1000) {
              text = text.slice(0, 1000) + "...";
            }
            docs += "<div>";
            docs += "<h3> Document - " + i + "</div>";
            docs += "<p>" + text + "</p>";
            docs += "</div>";
          }
          res.innerHTML = docs;
        }

        
</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>

</html>